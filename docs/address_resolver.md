# 地址解析引擎

## 背景与研究意义
- 在政务、电商、物流、金融等场景中，地址作为连接用户行为与地理实体的重要纽带，具有极高的业务价值。然而，实际应用中收集的中文地址数据常呈现出非标准、模糊、口语化、不完整等特征，造成定位精度低、解析失败率高，严重影响后续服务流程的智能化。
- 同时，主流地图引擎（如高德、百度）虽然提供了强大的 POI 查询能力，但其主要能力集中在“楼栋”层级，无法直接识别用户表达中的单元号、房号、口语描述等细节内容。
- 因此，构建一个具备“结构抽取、表达重写、语义推理、地图融合、私库兜底”等能力的智能地址解析系统，对提升系统智能水平和用户体验具有重要意义。

## 目标
旨在设计并实现一个中文地址解析系统，结合结构化自然语言处理与地图服务接口，达成以下目标：
- 高鲁棒性的地址结构化能力（NER + 模型标注）
- 面向搜索友好的地址表达标准化机制
- 精确与模糊结合的 POI 解析逻辑
- 基于锚点的周边智能搜索与推理能力
- 引入私有 POI 库和人工兜底机制，支持闭环优化


## 典型问题与挑战

| 类型           | 问题描述                     | 示例                |
|----------------|----------------------------|----------------------|
| 表达不规范     | 顺序颠倒、缩写错误、嵌套信息  | “蓝楼6-1-201 地华里”  |
| 字段缺失       | 省市区、小区名缺失或不明确    | “3号楼601”           |
| 口语俗称       | 非官方称呼或地标参参考        | “家乐福后面那个楼”    |
| API匹配限制    | 地图API无法解析单元/门牌号    | “中央公园A座903”     |
| 同名冲突       | 多地存在同名小区/楼盘         | “万达广场”           |
| 地图数据滞后   | 新建楼盘无法检索              | “融创中心三期11号楼”  |

## 技术路线

### 地址结构化（结构标签抽取）
目标：将原始自然语言地址切分为具有明确语义的字段片段，便于后续加工。
- 标签体系（五类）

方法：
- 自定义 NER（LLM+微调）
- Prompt 编排（LLM结构抽取）✅
- 模板化正则补充规则

| 标签  | 含义                     | 示例                          |
|-------|--------------------------|-------------------------------|
| AD    | 行政区划（省、市、区/街道）      | 天津市南开区                  |
| RD    | 道路名                         | 第二大街、东马路              |
| POI   | 兴趣点、小区、社区、楼名/楼宇编号 | 地华里、泰达新天地            |
| U     | 单元、门牌号信息                 | 6号楼1单元201室               |
| I     | 辅助位置信息                     | 北门附近、家乐福楼上          |

### 地址标准化（缩写转换与顺序整理）
目标：将结构化结果转换为地图 API 可识别的表达格式，包括缩写还原、顺序调整、字段重写等。
- 编号统一：B4 → B座4层
- 汉转阿：三号楼 → 3号楼
- 顺序调整：“902 泰达新天地 B4” → “泰达新天地 B座4层902室”
- 去除无关表达：“请放门口”、“老王家门口那栋”

技术方法：
- 显式规则重写引擎
- Prompt-based 顺序纠错 ✅
- 自定义结构化 → 文本模板渲染系统

集成地址结构化和标准化的提示词设计
```markdown
你是一位地址解析专家，擅长将自然语言地址切分为具有明确语义的字段片段，并进行类型分类。

请将以下自然语言地址分解为六类字段，并返回一个标准 JSON 对象。字段说明如下：

- **C**：直辖市、地级市（删除省一级信息）
- **D**：区县 + 街道/镇，不包含道路信息
- **AP**：兴趣点/小区/社区/道路/研究所（只有一个要素） + 楼名/楼宇编号
- **U**：单元、门牌、楼栋、房号等内部位置信息，不包括楼号
- **I**：辅助信息（如“附近”、“对面”、“门口”等）
- **T**：该地址所属的类型（如`商务住宅`、`地名地址信息`、`交通设施服务`、`餐饮服务`、`购物服务`、`生活服务`、`医疗保健服务`、`公司企业`、`科研机构`等）

要求：
* 抽取字段不需要覆盖全部文本，有些无关内容需要过滤
* **编号统一与缩写还原**，注意使用阿拉伯字母：
   - A3 → A座3层
   - 三号楼 → 3号楼
   - 四单元 → 4单元
   - 6-1-301 → 6号楼1单元301
* **表达标准化**：替换不规范或口语化表述，使其更适合地图定位系统。
* 输出为一个合法的 JSON 对象。
* 所有字段值为字符串类型，未识别字段填空字符串 ""。
* 不要添加任何说明或注释，直接返回 JSON。

示例输入：
浙江宁波市慈溪市长河镇长河镇云海村陆家路南3号

示例输出：
{ "C": "宁波市", "D": "慈溪市长河镇", "AP": "云海村南3号", "U": "", "I": "", "T": "地名地址信息" }

示例输入：
河北省保定市涞水县北京恒大京南半岛3-1-201靠近北门附近

示例输出：
{ "C": "保定市", "D": "涞水县", "AP": "北京恒大京南半岛3号楼", "U": "1单元201室", "I": "北门附近", "T": "商务住宅" }

示例输入：
北京经济技术开发区宏达北路8号请4号楼东侧3层货梯研发组原材料库房

示例输出：
{ "C": "北京市", "D": "经济技术开发区", "AP": "宏达北路8号请4号楼", "U": "1单元201室", "I": "东侧3层货梯", "T": "商务住宅" }

示例输入：
北京市中科院奥运村园区（林萃东路）中国科学院林翠东路遗传所新楼地下一层吕赫喆组

示例输出：
{ "C": "北京市", "D": "", "AP": "中科院奥运村园区（林萃东路）中国科学院林翠东路遗传所", "U": "地下一层", "I": "新楼", "T": "科研机构" }

示例输入：
浙江温州市平阳县鳌江镇浙江(平阳)万洋众创城F09-21A

示例输出：
{ "C": "温州市", "D": "平阳县鳌江镇", "AP": "万洋众创城F09栋", "U": "21A", "I": "", "T": "商务住宅"}

示例输入：
浙江宁波市鄞州区横溪镇人民北路32号1+1形象设计

示例输出：
{ "C": "宁波市", "D": "鄞州区横溪镇", "AP": "人民北路32号1+1形象设计", "U": "", "I": "", "T": "生活服务" }

示例输入：
六道口西北角的羊肉汤馆

示例输出：
{ "C": "北京市",  "D": "海淀区", "AP": "六道口羊肉汤馆", "U": "", "I": "西北角", "T": "餐饮服务" }

示例输入：
湖南省邵阳市武冈市迎春亭街道办事处苏湘粤五栋二单元1708号房您之前书香苑五单元二单元1708一号

示例输出：
{"C": "邵阳市", "D": "武冈市迎春亭街道办事处", "AP": "苏湘苑五栋", "U": "2单元1708号", "I": "书香苑五单元", "T": "商务住宅"}

现在请处理以下地址：
```

### POI搜索机制（楼栋级别匹配）

目标：调用地图服务（如高德）对标准化地址进行搜索，获取对应楼栋级别 POI。

注意事项：
- 高德POI搜索接口多数只能匹配到“楼”（单元、楼层、房间号匹配难度大）
- 高德POI搜索接口匹配效果不如搜索推荐接口好，但搜索推荐接口数据补全
- 搜索结果较少时，可能要对搜索关键词进行泛化，扩大搜索范围
- 多个搜索结果需进行排序匹配

技术方法：
- 查询关键词：城市名 + 标准地址
- 相似度算法：
  - LCS + Cosine + NGram 融合打分
  - 分词后向量相似度 + 重点编号匹配程度
- LLM 参与判断“最优匹配项”

### 锚点周边搜索策略
目标：用户的口语化地址描述可能与标准地址存在差异，当标准搜索结果不准确时，通过锚点 + 周边搜索策略模拟人类找路逻辑。

常见转换：
- 使用 POI 标签字段 → 地理编码 → 获取中心点坐标
- 构造弹性关键词：“B座”、“养殖场”、“写字楼”等
- 执行周边接口搜索周边
- 对搜索结果进行文本相似度打分 + 大模型推理筛选

### 私有 POI 数据库与兜底策略
目标：弥补地图API未覆盖的地理点，包括新建楼盘、农村区域、内网企业地点等。

主要功能：
- 私有化地址库路由
- 私有 POI 数据表（支持近似匹配）
- 手工地图标注器（经纬度选点工具）

## 应用前景
- 快递地址解析与分拣自动化
- 智能客服自动补全收件信息

## 扩展方向
- 引入用户反馈与纠错闭环（自动提升匹配率）
- 地图引擎融合（高德 + 百度 + 腾讯 + 私库联合）
- 构建 SaaS 地址解析API平台