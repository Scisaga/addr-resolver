<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>åœ°å€æ™ºèƒ½è§£æ</title>
    <script src="https://webapi.amap.com/maps?v=2.0&key={{ amap_key }}"></script>
    <style>
        body { font-family: sans-serif; padding: 2em; max-width: 800px; margin: auto; }
        #map { width: 100%; height: 400px; }
        textarea { width: 100%; height: 216px; font-family: monospace; }
        input[type=text] { width: 80%; padding: 0.6em; }
        button { padding: 0.5em 1em; }
        h2 { margin: 0; padding: 0.5em 0 }
        h3 { margin: 0; padding: 0.5em 0 }
    </style>
</head>
<body>
    <h2>ğŸ›¸ åœ°å€æ™ºèƒ½è§£æ
        <a href="/docs" style="display:block; float:right; font-size:0.8em; font-weight: normal; margin-left:1em">APIæ–‡æ¡£</a>
        <a href="/address" style="display:block; float:right; font-size:0.8em; font-weight: normal">ç§æœ‰åœ°å€åº“ç®¡ç†</a>
    </h2>
    <form method="post" action="/">
        <input type="text" name="address" value="{{ addr }}" placeholder="è¯·è¾“å…¥åœ°å€">
        <button type="submit">è§£æ</button>
    </form>
    <div></div>

    <h3>API è°ƒç”¨ç¤ºä¾‹</h3>
    <code style="border: 1px solid #ccc; background: #f4f4f4; padding: 0.2em 0.4em">GET /api/resolve?addr={{ addr }}</code>

    {% if result %}
    <a href="/api/resolve?addr={{ addr }}" target="_blank">ç‚¹å‡»æŸ¥çœ‹ JSON</a>
        <h3>è§£æç»“æœ <small style="font-weight: normal; color: #008800">ï¼ˆè€—æ—¶ï¼š{{ result.duration }} ç§’ï¼‰</small></h3>
        <textarea readonly>{{ structured_json }}</textarea>

        {% if result.location %}
            <h3>åœ°å›¾å®šä½</h3>
            <div id="map"></div>
            <script>
                const poiLocation = "{{ result.location }}";  // å¦‚ "116.438074,40.024988"
                const name = "{{ result.name }}";
                const lnglat = poiLocation.split(',').map(parseFloat);

                const map = new AMap.Map('map', {
                    zoom: 16,
                    center: lnglat
                });

                const marker = new AMap.Marker({
                    position: lnglat,
                    title: name,
                    map: map,
                    cursor: 'pointer'
                });

                marker.on('click', function () {
                    const url = `https://www.amap.com/search?query=${encodeURIComponent(name)}&zoom=16&center=${poiLocation}`;
                    window.open(url, "_blank");
                });

                const infoWindow = new AMap.InfoWindow({
                    content: `<strong>${name}</strong><br>ç‚¹å‡»æ ‡è®°è·³è½¬é«˜å¾·åœ°å›¾`,
                    offset: new AMap.Pixel(0, -30)
                });
                infoWindow.open(map, marker.getPosition());
            </script>
        {% endif %}
    {% elif submitted %}
        <h3 style="color: red;">æ— åŒ¹é…åœ°å€</h3>
    {% endif %}

</body>
</html>
